var e=require("react"),t=require("gqless"),r="undefined"==typeof window||/ServerSideRendering/.test(window.navigator&&window.navigator.userAgent)?function(e){return e()}:e.useLayoutEffect,n=new WeakMap,u=function(e){try{return null!==e&&"object"==typeof e&&!!t.getAccessor(e)}catch(e){return!1}},c={get:function(e,t){var r=Reflect.get(e,t);return"function"==typeof r&&Array.isArray(e)?Array.prototype[t].bind(o(e)):"function"==typeof r||u(r)?o(r):r},apply:function(e,t,r){var n=Reflect.apply(e,t,r);return"function"==typeof n||u(n)?o(n):n}},o=function(e){var t=n.get(e);return t||(t=new Proxy(e,c),n.set(e,t)),t};exports.useQuery=function(u){var a=function(){var t=e.useRef([]),r=e.useCallback(function(e){var r=setTimeout(e,5e3);t.current.push({timer:r,func:e})},[]);return e.useEffect(function(){var e=t.current;return e.forEach(function(e){return clearTimeout(e.timer)}),function(){e.forEach(function(e){return(0,e.func)()})}},[]),r}(),f=e.useReducer(function(e){return e+1},0)[1],i=e.useRef(!1);if(i.current)throw new Promise(function(e){u.scheduler.commit.onFetched.then(function(){i.current=!1,e()})});r(function(){u.scheduler.commit.accessors.size>0&&(i.current=!0,f())});var s=e.useRef(new Map),p=e.useCallback(function(e){var t=s.current.get(e);t||s.current.set(e,t=function(){!function e(t){if("object"==typeof t.data){var r=new Proxy(t.data,c);n.set(t.data,r)}t.parent&&e(t.parent)}(e),i.current||f()}),a(e.onDataChange(t))},[a]);t.accessorInterceptors.add(p);var d=setTimeout(function(){t.accessorInterceptors.delete(p)},5e3);return e.useEffect(function(){clearTimeout(d),t.accessorInterceptors.delete(p)}),o(u.query)};
//# sourceMappingURL=index.js.map
