var e=require("react"),t=require("gqless"),r="undefined"==typeof window||/ServerSideRendering/.test(window.navigator&&window.navigator.userAgent)?function(e){return e()}:e.useLayoutEffect,n=new WeakMap,u=function(e){try{return null!==e&&"object"==typeof e&&!!t.getAccessor(e)}catch(e){return!1}},c={get:function(e,t){var r=Reflect.get(e,t);return"function"==typeof r&&Array.isArray(e)?Array.prototype[t].bind(o(e)):"function"==typeof r||u(r)?o(r):r},apply:function(e,t,r){var n=Reflect.apply(e,t,r);return"function"==typeof n||u(n)?o(n):n}},o=function(e){var t=n.get(e);return t||(t=new Proxy(e,c),n.set(e,t)),t},f=process.env.EXPERIMENTAL_USE_CLENAUP_FOR_CM?function(){var t=e.useRef([]),r=e.useCallback(function(e){var r=setTimeout(e,5e3);t.current.push({timer:r,func:e})},[]);return e.useEffect(function(){var e=t.current;return e.forEach(function(e){return clearTimeout(e.timer)}),function(){e.forEach(function(e){return(0,e.func)()})}},[]),r}:function(){var t=e.useRef([]),r=e.useCallback(function(e){t.current.push(e)},[]);return e.useEffect(function(){var e=t.current;return function(){e.forEach(function(e){return e()})}},[]),r};exports.useQuery=function(u){var a=f(),i=e.useReducer(function(e){return e+1},0)[1],s=e.useRef(!1);if(s.current)throw new Promise(function(e){u.scheduler.commit.onFetched.then(function(){s.current=!1,e()})});r(function(){u.scheduler.commit.accessors.size>0&&(s.current=!0,i())});var p=e.useRef(new Map),d=e.useCallback(function(e){var t=p.current.get(e);t||p.current.set(e,t=function(){!function e(t){if("object"==typeof t.data){var r=new Proxy(t.data,c);n.set(t.data,r)}t.parent&&e(t.parent)}(e),s.current||i()}),a(e.onDataChange(t))},[a]);t.accessorInterceptors.add(d);var l=setTimeout(function(){t.accessorInterceptors.delete(d)},5e3);return e.useEffect(function(){clearTimeout(l),t.accessorInterceptors.delete(d)}),o(u.query)};
//# sourceMappingURL=index.js.map
