{"version":3,"file":"index.esm.js","sources":["../src/index.ts"],"sourcesContent":["import {\n  useCallback,\n  useLayoutEffect,\n  useReducer,\n  useRef,\n} from 'react';\nimport { Client } from 'gqless';\n\nconst isSSR = (\n  typeof window === 'undefined'\n  || /ServerSideRendering/.test(window.navigator && window.navigator.userAgent)\n);\n\nconst useIsomorphicLayoutEffect = isSSR ? (cb: () => void) => cb() : useLayoutEffect;\n\n/**\n * useQuery\n *\n * This hook returns query from gqless.\n *\n * @example\n * import { useQuery } from 'gqless-hook';\n * import { client } from '../graphql'; // generated by @gqless/cli\n *\n * const Component = () => {\n *   const query = useQuery(client);\n *   return (\n *     <div>{query.foo}</div>\n *   );\n * };\n */\nexport const useQuery = <Data>(client: Client<Data>): Data => {\n  const [, forceUpdate] = useReducer((c) => c + 1, 0);\n  const fetching = useRef(false);\n  if (fetching.current) {\n    throw new Promise((resolve) => {\n      client.scheduler.commit.onFetched.then(resolve);\n    });\n  }\n  const onActive = useCallback(() => {\n    fetching.current = true;\n  }, []);\n  const onFetched = useCallback(() => {\n    fetching.current = false;\n  }, []);\n  client.scheduler.commit.onActive.then(onActive);\n  client.scheduler.commit.onFetched.then(onFetched);\n  useIsomorphicLayoutEffect(() => {\n    if (fetching.current) {\n      forceUpdate();\n    } else if (client.scheduler.commit.accessors.size > 0) {\n      fetching.current = true;\n      forceUpdate();\n    }\n  });\n  return client.query;\n};\n"],"names":["useIsomorphicLayoutEffect","window","test","navigator","userAgent","cb","useLayoutEffect","useQuery","client","forceUpdate","useReducer","c","fetching","useRef","current","Promise","resolve","scheduler","commit","onFetched","then","onActive","useCallback","accessors","size","query"],"mappings":"qFAQA,IAKMA,EAJc,oBAAXC,QACJ,sBAAsBC,KAAKD,OAAOE,WAAaF,OAAOE,UAAUC,WAG3B,SAACC,UAAmBA,KAAOC,EAkBxDC,EAAW,SAAOC,OACpBC,EAAeC,EAAW,SAACC,UAAMA,EAAI,GAAG,MAC3CC,EAAWC,GAAO,GACxB,GAAID,EAASE,QACX,UAAUC,QAAQ,SAACC,GACjBR,EAAOS,UAAUC,OAAOC,UAAUC,KAAKJ,KAG3C,IAAMK,EAAWC,EAAY,WAC3BV,EAASE,SAAU,GAClB,IACGK,EAAYG,EAAY,WAC5BV,EAASE,SAAU,GAClB,IAWH,OAVAN,EAAOS,UAAUC,OAAOG,SAASD,KAAKC,GACtCb,EAAOS,UAAUC,OAAOC,UAAUC,KAAKD,GACvCnB,EAA0B,WACpBY,EAASE,QACXL,IACSD,EAAOS,UAAUC,OAAOK,UAAUC,KAAO,IAClDZ,EAASE,SAAU,EACnBL,OAGGD,EAAOiB"}