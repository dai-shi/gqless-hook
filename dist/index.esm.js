import{useLayoutEffect as n,useRef as t,useCallback as r,useEffect as e,useReducer as u}from"react";import{getAccessor as o,accessorInterceptors as c}from"gqless";var i="undefined"==typeof window||/ServerSideRendering/.test(window.navigator&&window.navigator.userAgent)?function(n){return n()}:n,f=new WeakMap,a=function(n){try{return null!==n&&"object"==typeof n&&!!o(n)}catch(n){return!1}},p={get:function(n,t){var r=Reflect.get(n,t);return"function"==typeof r&&Array.isArray(n)?Array.prototype[t].bind(s(n)):"function"==typeof r||a(r)?s(r):r},apply:function(n,t,r){var e=Reflect.apply(n,t,r);return"function"==typeof e||a(e)?s(e):e}},s=function(n){var t=f.get(n);return t||(t=new Proxy(n,p),f.set(n,t)),t},d=process.env.EXPERIMENTAL_USE_CLENAUP_FOR_CM?function(){var n=t([]),u=r(function(t){var r=setTimeout(t,5e3);n.current.push({timer:r,func:t})},[]);return e(function(){var t=n.current;return t.forEach(function(n){return clearTimeout(n.timer)}),function(){t.forEach(function(n){return(0,n.func)()})}},[]),u}:function(){var n=t([]),u=r(function(t){n.current.push(t)},[]);return e(function(){var t=n.current;return function(){t.forEach(function(n){return n()})}},[]),u},v=function(n){var o=d(),a=u(function(n){return n+1},0)[1],v=t(!1);if(v.current)throw new Promise(function(t){n.scheduler.commit.onFetched.then(function(){v.current=!1,t()})});i(function(){n.scheduler.commit.accessors.size>0&&(v.current=!0,a())});var y=t(new Map),m=r(function(n){var t=y.current.get(n);t||y.current.set(n,t=function(){!function n(t){if("object"==typeof t.data){var r=new Proxy(t.data,p);f.set(t.data,r)}t.parent&&n(t.parent)}(n),v.current||a()}),o(n.onDataChange(t))},[o]);c.add(m);var l=setTimeout(function(){c.delete(m)},5e3);return e(function(){clearTimeout(l),c.delete(m)}),s(n.query)};export{v as useQuery};
//# sourceMappingURL=index.esm.js.map
