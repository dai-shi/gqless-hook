import{useLayoutEffect as t,useRef as n,useCallback as e,useEffect as r,useReducer as o}from"react";import{getAccessor as u,accessorInterceptors as c}from"gqless";var i="undefined"==typeof window||/ServerSideRendering/.test(window.navigator&&window.navigator.userAgent)?function(t){return t()}:t,a=new WeakMap,f=function(t){try{return null!==t&&"object"==typeof t&&!!u(t)}catch(t){return!1}},p={get:function(t,n){var e=Reflect.get(t,n);return"function"==typeof e&&Array.isArray(t)?Array.prototype[n].bind(d(t)):"function"==typeof e||f(e)?d(e):e},apply:function(t,n,e){var r=Reflect.apply(t,n,e);return"function"==typeof r||f(r)?d(r):r}},d=function(t){var n=a.get(t);return n||(n=new Proxy(t,p),a.set(t,n)),n},s=function(t){var u=function(){var t=n([]),o=e(function(n){var e=setTimeout(n,5e3);t.current.push({timer:e,func:n})},[]);return r(function(){var n=t.current;return n.forEach(function(t){return clearTimeout(t.timer)}),function(){n.forEach(function(t){return(0,t.func)()})}},[]),o}(),f=o(function(t){return t+1},0)[1],s=n(!1);if(s.current)throw new Promise(function(n){t.scheduler.commit.onFetched.then(function(){s.current=!1,n()})});i(function(){t.scheduler.commit.accessors.size>0&&(s.current=!0,f())});var y=n(new Map),m=e(function(t){var n=y.current.get(t);n||y.current.set(t,n=function(){!function t(n){if("object"==typeof n.data){var e=new Proxy(n.data,p);a.set(n.data,e)}n.parent&&t(n.parent)}(t),s.current||f()}),u(t.onDataChange(n))},[u]);c.add(m);var v=setTimeout(function(){c.delete(m)},5e3);return r(function(){clearTimeout(v),c.delete(m)}),d(t.query)};export{s as useQuery};
//# sourceMappingURL=index.esm.js.map
